{% extends "base.html" %}
{% set hide_header = true %}
{% set hide_footer = true %}
{% block title %}Reset Password - CourseXcel{% endblock %}
{% block content %}
<div class="login-container">
    <form method="post" onsubmit="return validatePasswords()">
        <h2>Reset Password</h2>

        <div class="input-group">
            <input type="password" name="new_password" id="new_password" required>
            <label for="new_password">New Password</label>
            <button type="button" onclick="togglePassword('new_password', this)">
                <i class="fas fa-eye"></i>
            </button>
        </div>    

        <div class="input-group">
            <input type="password" name="confirm_password" id="confirm_password" required>
            <label for="confirm_password">Confirm Password</label>
            <button type="button" onclick="togglePassword('confirm_password', this)">
                <i class="fas fa-eye"></i>
            </button>
        </div>    

        <button class="reset-btn" type="submit">Confirm</button>
    </form>
</div>
{% endblock %}

{% block scripts %}
<script>
    function togglePassword(inputId, button) {
        var input = document.getElementById(inputId);
        var icon = button.querySelector('i');

        if (input.type === 'password') {
            input.type = 'text';
            icon.classList.replace('fa-eye', 'fa-eye-slash');
        } else {
            input.type = 'password';
            icon.classList.replace('fa-eye-slash', 'fa-eye');
        }
    }

    function validatePasswords() {
        const newPassword = document.getElementById('new_password').value;
        const confirmPassword = document.getElementById('confirm_password').value;

        if (newPassword !== confirmPassword) {
            Swal.fire({
                icon: 'error',
                title: 'Passwords do not match',
                text: 'Please make sure both password fields are the same.'
            });
            return false;
        }
        
        const minLength = 8;
        const hasLetter = /[A-Za-z]/.test(newPassword);
        const hasNumber = /[0-9]/.test(newPassword);
        const hasSpecial = /[!@#$%^&*(),.?":{}|<>_]/.test(newPassword);

        if (newPassword.length < minLength) {
            Swal.fire({
                icon: 'warning',
                title: 'Weak Password',
                text: 'Password must be at least 8 characters long.'
            });
            return false;
        }

        if (!hasLetter || !hasNumber || !hasSpecial) {
            Swal.fire({
                icon: 'info',
                title: 'Incomplete Password',
                text: 'Password must include letters, numbers, and special symbols.'
            });
            return false;
        }
        return true;
    }
</script>
{% endblock %}
